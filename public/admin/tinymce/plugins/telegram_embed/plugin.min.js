tinymce.PluginManager.add('telegram_embed', function(editor, url) {
	var openDialog = function () {
		return editor.windowManager.open({
			title: 'Telegram Embed',
			body: {
				type: 'panel',
				items: [
					{
						type: 'input',
						name: 'source',
						label: 'Source',
					},
					{
						type: 'grid', // component type
						columns: 2, // number of columns
						items: [
							{
								type: 'input',
								name: 'width',
								label: 'Width',
								display: 'inline'
							},
							{
								type: 'input',
								name: 'height',
								label: 'Height',
								display: 'inline'
							},
						] // array of panel components
					}

				]
			},
			buttons: [
				{
					type: 'cancel',
					text: 'Close'
				},
				{
					type: 'submit',
					text: 'Add',
					primary: true
				}
			],
			onSubmit: function (api) {
				var data = api.getData();
				var div = document.createElement('div');

				var iframe = `<div class="telegram-embed-content">
						<iframe src="${data.source}?embed=1"`;

				if(data.width) {
					iframe += ` width="${data.width}"`
				}

				if(data.height) {
					iframe += ` height="${data.height}"`
				}

				iframe += `</iframe></div>`;

				// Insert content when the window form is submitted
				editor.insertContent(iframe);
				api.close();
			}
		});
	};

	// Add a button that opens a window
	editor.ui.registry.addButton('telegram_embed', {
		// icon: 'fa fa-telegram',
		// text: 'Embed',
		text: '<span class="fa fa-telegram" style="font-size: 18px; font-family: \'FontAwesome\'" aria-hidden="true"></span>',
		onAction: function () {
			// Open window
			openDialog();
		}
	});



	// Adds a menu item, which can then be included in any menu via the menu/menubar configuration
	editor.ui.registry.addMenuItem('telegram_embed', {
		text: 'Telegram Embed',
		onAction: function() {
			// Open window
			openDialog();
		}
	});

	return {
		getMetadata: function () {
			return  {
				name: 'Telegram Embed',
			};
		}
	};
});
