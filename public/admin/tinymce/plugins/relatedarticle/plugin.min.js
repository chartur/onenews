tinymce.PluginManager.add('relatedarticle', function(editor, url) {
	var openDialog = function () {
		return editor.windowManager.open({
			title: 'Նորություն',
			body: {
				type: 'panel',
				items: [
					{
						type: 'selectbox',
						name: 'category',
						label: 'Կատեգորիա',
						items: cats.map(getCatsElement)
					},
					{
						type: 'selectbox',
						name: 'post_type',
						label: 'Նորություն տեսակը',
						items: [
							{value: 'popular', text: 'Ամենաընթերցված նյութը'},
							{value: 'unpopular', text: 'Ամենաքիչ ընթերցված նյութը'},
							{value: 'latest', text: 'Վերջին'},
						]
					},
				]
			},
			buttons: [
				{
					type: 'cancel',
					text: 'Close'
				},
				{
					type: 'submit',
					text: 'Add',
					primary: true
				}
			],
			onSubmit: function (api) {
				var data = api.getData();

				var div = `<div class="middle-news mceNotEditable" data-url="/loader/single-related-post?category=${data.category}&post_type=${data.post_type}">
				<p>Կատեգորիա - ${data.category}</p>
				<p>Փոստի տեսակը - ${data.post_type}</p>
</div>`

				editor.insertContent(div);
				api.close();
			}
		});
	};

	// Add a button that opens a window
	editor.ui.registry.addButton('relatedarticle', {
		// icon: 'fa fa-telegram',
		// text: 'Embed',
		text: '<span class="fa fa-retweet" style="font-size: 18px; font-family: \'FontAwesome\'" aria-hidden="true"></span>',
		onAction: function () {
			// Open window
			openDialog();
		}
	});



	// Adds a menu item, which can then be included in any menu via the menu/menubar configuration
	editor.ui.registry.addMenuItem('relatedarticle', {
		text: 'Նորություն',
		onAction: function() {
			// Open window
			openDialog();
		}
	});

	return {
		getMetadata: function () {
			return  {
				name: 'Նորություն',
			};
		}
	};
});


function getCatsElement(el) {
	return { value: el.id.toString(), text: el.hy_name }
}